-module( foobar ).

-behaviour( gen_server ).
-export( [ init/1, handle_call/3, handle_cast/2, handle_info/2, terminate/2, code_change/3 ] ).

-export( [ start_link/0 ] ).

-record( state, {
	foos,
	bars
} ).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Module API
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%====================================================================
%% start_link/2
%%====================================================================
start_link() ->
	gen_server:start_link( ?MODULE, [], [] ).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% gen_server callbacks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%====================================================================
%% init/2
%%====================================================================
init( [] ) ->
	State = #state{
		foos = 0,
		bars = 0
	},
	{ ok, State }.

%%====================================================================
%% handle_call/2
%%====================================================================
handle_call( _Request, _From, State ) ->
	{ reply, ok, State }.

%%====================================================================
%% handle_cast/2
%%====================================================================
%% Foo
%%--------------------------------------------------------------------
handle_cast( { Channel, privmsg, _, "-foo" }, State ) ->
	channel:say( Channel, "Bar!" ),
	{ noreply, State#state{ foos = State#state.foos + 1 } };
%%--------------------------------------------------------------------
%% Bar
%%--------------------------------------------------------------------
handle_cast( { Channel, privmsg, _, "-bar" }, State ) ->
	channel:say( Channel, "Foo!" ),
	{ noreply, State#state{ foos = State#state.bars + 1 } };
%%--------------------------------------------------------------------
%% Stats
%%--------------------------------------------------------------------
handle_cast( { Channel,  privmsg, _, "-stats" }, State ) ->
	channel:say( Channel, lists:concat( [ "Foos: ", State#state.foos, " Bars: ", State#state.bars ] ) ),
	{ noreply, State };
%%--------------------------------------------------------------------
%% Clear
%%--------------------------------------------------------------------
handle_cast( { _,  privmsg, _, "-clear" }, State ) ->
	{ noreply, State#state{ foos = 0, bars = 0 } };
%%--------------------------------------------------------------------
%% Catch all casts
%%--------------------------------------------------------------------
handle_cast( _Msg, State ) ->
	{ noreply, State }.

%%====================================================================
%% handle_info/2
%%====================================================================
handle_info( _Info, State ) ->
	{ noreply, State }.

%%====================================================================
%% terminate/2
%%====================================================================
terminate( _Reason, _State ) -> 
	ok.

%%====================================================================
%% code_change/3
%%====================================================================
code_change( _OldVsn, State, _Extra ) -> 
	{ ok, State }.
  
